<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnswerIT!! - Setup & Configuration</title>
    <link rel="icon" href="https://i.pinimg.com/736x/d9/b5/a6/d9b5a64b2a0f432e41f611ddd410d8be.jpg">
    <link rel="stylesheet" href="configure.css">
</head>
<body>
    <div class="hero">
        <button id="themeToggle" class="theme-toggle" title="Toggle theme">üåô</button>
        <h1>üéØ AnswerIT!!</h1>
        <p>Setup your AI-powered answer generator and configure your preferences</p>
        <div id="detectionStatus" class="detection-status">üîç Detecting userscript...</div>
    </div>

    <div class="container">
        <div class="grid">
            <div class="card">
                <div class="card-icon">üìö</div>
                <h2>How to Use</h2>
                <p>Get started with AnswerIT!! in just a few steps</p>
                <div style="text-align: left; margin-top: 1rem;">
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 1:</strong> Get your free Gemini API key</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 2:</strong> Enter your API key above</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 3:</strong> Configure your preferences</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 4:</strong> Use <span id="modifierKey">Alt</span> + [hotkey] on supported sites</div>
                </div>
                <div class="quick-links">
                    <a href="https://github.com/NytLyt512/Userscripts/tree/main/AnswerIT!!" target="_blank" class="quick-link">üìñ Github Page</a>
                    <a href="https://github.com/NytLyt512/Userscripts/issues/new?title=[AnswerIT!!]%20**Title%20of%20the%20issue**%20&body=**Describe%20the%20issue:**%0A%0A**Steps%20to%20reproduce:**%0A%0A**Expected%20behavior:**%0A%0A**Screenshots%20(optional):**%0A%0A**Environment:**%0A-%20Browser:%0A-%20OS:%0A" target="_blank" class="quick-link">üêõ Report Issues</a>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">üîë</div>
                <h2>API Key Setup</h2>
                <p>Configure your Gemini API key to start using AI-powered answers</p>
                <div class="status" id="apiStatus"></div>
                <form id="apiForm">
                    <div class="form-group">
                        <label class="form-label">Gemini API Key</label>
                        <input type="password" id="apiKey" class="form-input" placeholder="Enter your Gemini API key..."
                            autocomplete="off">
                        <div class="help-text">Your API key is stored securely and never sent to our servers.</div>
                    </div>
                    <div class="quick-links">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="quick-link">üîó Get Free
                            API Key</a>
                        <a href="#" id="testKey" class="quick-link">üß™ Test API Key</a>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveApi" style="margin-top: 1rem;">
                        <span id="saveApiText">Save API Key</span>
                        <div class="spinner" id="saveApiSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>
        </div>

        <div class="preferences-section">
            <div class="card">
                <div class="card-icon">‚öôÔ∏è</div>
                <h2>Preferences</h2>
                <p>Customize your AnswerIT!! experience</p>
                <div class="status" id="settingsStatus"></div>
                <form id="settingsForm">
                    <div class="preferences-grid">
                        <div class="form-group">
                            <label class="form-label">üî• Hotkey</label>
                            <select id="hotkey" class="form-input">
                                <option value="a"><span id="hotkeyModifier">Alt</span> + A</option>
                                <option value="q"><span id="hotkeyModifier">Alt</span> + Q</option>
                                <option value="z"><span id="hotkeyModifier">Alt</span> + Z</option>
                                <option value="x"><span id="hotkeyModifier">Alt</span> + X</option>
                            </select>
                            <div class="help-text">Keyboard shortcut to activate AnswerIT!!</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Theme</label>
                            <select id="theme" class="form-input">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto (System)</option>
                            </select>
                            <div class="help-text">Choose your preferred theme for the popup</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" id="autoRun" class="toggle-input">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Auto-run on question detection</span>
                        </label>
                        <div class="help-text">Automatically generate answers when questions are detected</div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveSettings" style="margin-top: 1rem;">
                        <span id="saveSettingsText">Save Settings</span>
                        <div class="spinner" id="saveSettingsSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>

            <!-- Reflector Mode Setup Section -->
            <div class="card" id="reflectorCard">
                <div class="card-icon">üñ•Ô∏è</div>
                <h2>Reflector Mode Setup</h2>
                <p>Mirror your host device's question area to another device in real time.<br>Use this section to set up and connect your devices.</p>
                <div class="status" id="reflectorStatus"></div>
                <div class="form-group">
                    <label class="toggle-label">
                        <input type="checkbox" id="reflectorEnable" class="toggle-input">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Enable Reflector Mode (Host)</span>
                    </label>
                    <div class="help-text">Turn on to start broadcasting your question area.</div>
                </div>
                <div id="reflectorOfferSection" style="display:none;">
                    <label class="form-label">Your Offer (Host)</label>
                    <textarea id="reflectorOffer" class="form-input" rows="4" readonly></textarea>
                    <div style="margin:0.5rem 0;">
                        <button class="btn btn-secondary" id="copyOfferBtn">Copy Offer</button>
                        <button class="btn btn-secondary" id="showOfferQRBtn">Show QR</button>
                        <span id="offerQRContainer" style="display:none; margin-left:1rem;"></span>
                    </div>
                    <div class="help-text">Share this offer with your reflector device (scan QR or copy text).</div>
                </div>
                <div id="reflectorAnswerSection" style="display:none; margin-top:1rem;">
                    <label class="form-label">Paste Answer from Reflector Device</label>
                    <textarea id="reflectorAnswer" class="form-input" rows="4" placeholder="Paste answer here..."></textarea>
                    <button class="btn btn-primary" id="submitAnswerBtn" style="margin-top:0.5rem;">Submit Answer</button>
                    <div class="help-text">Paste the answer code from the reflector device to complete the connection.</div>
                </div>
                <div id="reflectorStatusMsg" style="margin-top:1rem; font-weight:600;"></div>
                <button class="btn btn-primary" id="gotoReflectorBtn" style="margin-top:2rem;">Open Reflector Page</button>
            </div>
        </div>

        <div class="sites-section">
            <h2>üåê Supported Learning Platforms</h2>
            <p>AnswerIT!! works seamlessly with these platforms. Click any site to visit it directly.</p>
            <div class="sites-grid" id="sitesGrid"></div>
        </div>
    </div>

    <!-- Include jQuery from a CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script>
        class ConfigManager {
            constructor() {
                this.currentTheme = localStorage.getItem('answerIT_pageTheme') || 'light';
                this.isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                this.configDetected = false;
                this.initTheme();
                this.initModifierKeys();
                this.initEventListeners();
                this.detectUserscript();
            }

            // --- Reflector Mode Setup Logic ---
            reflectorInit() {
                // Elements
                const $enable = $('#reflectorEnable');
                const $offerSection = $('#reflectorOfferSection');
                const $offer = $('#reflectorOffer');
                const $copyOfferBtn = $('#copyOfferBtn');
                const $showOfferQRBtn = $('#showOfferQRBtn');
                const $offerQRContainer = $('#offerQRContainer');
                const $answerSection = $('#reflectorAnswerSection');
                const $answer = $('#reflectorAnswer');
                const $submitAnswerBtn = $('#submitAnswerBtn');
                const $statusMsg = $('#reflectorStatusMsg');
                const $gotoReflectorBtn = $('#gotoReflectorBtn');

                // Load initial state
                let reflectorConfig = window.AnswerIT_Config?.getConfig()?.reflector;
                let reflectorHost = window.AnswerIT_Config?.reflectorHost;
                let offer = reflectorConfig?.offer || '';
                let answer = reflectorConfig?.answer || '';
                let enabled = reflectorConfig?.enabled || false;
                $enable.prop('checked', enabled);

                function updateOfferDisplay() {
                    if (enabled && offer) {
                        $offerSection.show();
                        $offer.val(offer);
                        $showOfferQRBtn.show();
                        $copyOfferBtn.show();
                    } else {
                        $offerSection.hide();
                        $offer.val('');
                        $showOfferQRBtn.hide();
                        $copyOfferBtn.hide();
                        $offerQRContainer.hide();
                    }
                }

                function updateAnswerDisplay() {
                    if (enabled && offer) {
                        $answerSection.show();
                        $answer.val(answer || '');
                    } else {
                        $answerSection.hide();
                        $answer.val('');
                    }
                }

                function updateStatus(msg, type) {
                    $statusMsg.text(msg);
                    $statusMsg.css('color', type === 'success' ? '#10b981' : (type === 'error' ? '#ef4444' : '#f59e0b'));
                }

                // Enable/disable reflector mode
                $enable.on('change', function() {
                    enabled = $enable.prop('checked');
                    reflectorHost = enabled ? reflectorHost?.setup() : reflectorHost?.teardown();
                    reflectorConfig.enabled = enabled;
                    window.AnswerIT_Config.setConfig({ reflector: reflectorConfig });
                    updateOfferDisplay();
                    updateAnswerDisplay();
                    updateStatus(enabled ? 'Reflector mode enabled. Waiting for offer...' : 'Reflector mode disabled.', enabled ? 'warning' : 'error');
                });

                // Copy offer
                $copyOfferBtn.on('click', function() {
                    if (offer) {
                        navigator.clipboard.writeText(offer).then(function() {
                            $copyOfferBtn.text('Copied!');
                            setTimeout(function() { $copyOfferBtn.text('Copy Offer'); }, 1200);
                        });
                    }
                });

                // Show QR code
                $showOfferQRBtn.on('click', function() {
                    if (offer) {
                        if ($offerQRContainer.is(':visible')) {
                            $offerQRContainer.hide();
                            $offerQRContainer.html('');
                            $showOfferQRBtn.text('Show QR');
                        } else {
                            $offerQRContainer.show();
                            $offerQRContainer.html('');
                            QRCode.toCanvas(offer, { width: 180 }, function (err, canvas) {
                                if (!err) $offerQRContainer.append(canvas);
                            });
                            $showOfferQRBtn.text('Hide QR');
                        }
                    }
                });

                // Submit answer
                $submitAnswerBtn.on('click', function() {
                    answer = $answer.val().trim();
                    if (!answer) { updateStatus('Please paste the answer from the reflector device.', 'error'); return; }
                    reflectorConfig.answer = answer;
                    window.AnswerIT_Config.setConfig({ reflector: reflectorConfig });
                    updateStatus('Answer submitted. Connection should complete on host.', 'success');
                });

                // Open reflector page
                $gotoReflectorBtn.on('click', function() {
                    window.open('reflector.html', '_blank');
                });

                // Initial display
                updateOfferDisplay();
                updateAnswerDisplay();
                updateStatus(enabled ? 'Reflector mode enabled. Waiting for offer...' : 'Reflector mode disabled.', enabled ? 'warning' : 'error');

                // Poll for offer/answer updates from userscript
                setInterval(function() {
                    let newConfig = window.AnswerIT_Config?.getConfig()?.reflector;
                    if (newConfig.offer !== offer) { offer = newConfig.offer || ''; updateOfferDisplay(); }
                    if (newConfig.answer !== answer) { answer = newConfig.answer || ''; updateAnswerDisplay(); }
                }, 1000);
            }

            async detectUserscript() {
                console.log('[ConfigPage] Starting userscript detection...');
                this.updateDetectionStatus('üîç Detecting userscript...', '');

                // Method 1: Check if already available
                if (window.AnswerIT_Config?.getConfig) {
                    console.log('[ConfigPage] Userscript detected immediately');
                    this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                    this.onConfigDetected();
                    return;
                }

                // Method 2: Wait for custom event
                const eventListener = (e) => {
                    console.log('[ConfigPage] Userscript detected via event');
                    $(window).off('AnswerIT_ConfigReady', eventListener); // Use jQuery .off()
                    this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                    this.onConfigDetected();
                };
                $(window).on('AnswerIT_ConfigReady', eventListener); // Use jQuery .on()

                // Method 3: Polling with exponential backoff
                let attempts = 0;
                const maxAttempts = 15;
                const pollForConfig = () => {
                    attempts++;
                    console.log(`[ConfigPage] Polling attempt ${attempts}/${maxAttempts}`);
                    this.updateDetectionStatus(`üîç Checking for userscript... (${attempts}/${maxAttempts})`, '');

                    if (window.AnswerIT_Config?.getConfig) {
                        console.log('[ConfigPage] Userscript detected via polling');
                        $(window).off('AnswerIT_ConfigReady', eventListener);
                        this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                        this.onConfigDetected();
                        return;
                    }

                    if (attempts < maxAttempts) {
                        // Exponential backoff: 100ms, 200ms, 400ms, 800ms, etc.
                        const delay = Math.min(100 * Math.pow(2, attempts - 1), 2000);
                        setTimeout(pollForConfig, delay);
                    } else {
                        console.log('[ConfigPage] Userscript not detected, using fallback');
                        $(window).off('AnswerIT_ConfigReady', eventListener);
                        this.updateDetectionStatus('‚ö†Ô∏è Using local storage mode', 'warning');
                        this.onConfigDetected(); // Load with fallback
                    }
                };

                // Start polling after a short delay
                setTimeout(pollForConfig, 100);
            }

            updateDetectionStatus(message, type) {
                const $status = $('#detectionStatus'); // Use jQuery selector
                $status.text(message); // Use jQuery .text()
                $status.attr('class', `detection-status ${type}`); // Use jQuery .attr()

                // Hide status after successful connection
                if (type === 'success') {
                    setTimeout(() => {
                        $status.animate({ opacity: 0 }, 300, () => { // Use jQuery .animate()
                            $status.hide(); // Use jQuery .hide()
                        });
                    }, 2000);
                }
            }

            onConfigDetected() {
                if (this.configDetected) return; // Prevent multiple calls
                this.configDetected = true;
                console.log('[ConfigPage] Initializing with config:', !!window.AnswerIT_Config);
                this.loadSettings();
                this.renderSites();
            }

            initTheme() {
                this.applyTheme(this.currentTheme);
                const $toggle = $('#themeToggle'); // Use jQuery selector
                $toggle.text(this.currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è'); // Use jQuery .text()
                $toggle.attr('title', `Switch to ${this.currentTheme === 'light' ? 'dark' : 'light'} theme`); // Use jQuery .attr()
            }

            initModifierKeys() {
                const modifierKey = this.isMac ? 'Cmd' : 'Alt';
                $('#modifierKey').text(modifierKey); // Use jQuery .text()
                // Update hotkey options
                $('#hotkey option').each(function () { // Use jQuery .each()
                    const $option = $(this);
                    const key = $option.val().toUpperCase();
                    $option.text(`${modifierKey} + ${key}`); // Use jQuery .text()
                });
            }

            initEventListeners() {
                $('#themeToggle').on('click', () => this.toggleTheme()); // Use jQuery .on()
                $('#apiForm').on('submit', (e) => { e.preventDefault(); this.saveApiKey(); }); // Use jQuery .on()
                $('#settingsForm').on('submit', (e) => { e.preventDefault(); this.saveSettings(); }); // Use jQuery .on()
                $('#testKey').on('click', (e) => { e.preventDefault(); this.testApiKey(); }); // Use jQuery .on()
                $('#apiKey').on('input', (e) => this.validateApiKey($(e.target).val())); // Use jQuery .val() and .on()
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                this.applyTheme(this.currentTheme);
                localStorage.setItem('answerIT_pageTheme', this.currentTheme);
                const $toggle = $('#themeToggle');
                $toggle.text(this.currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è');
                $toggle.attr('title', `Switch to ${this.currentTheme === 'light' ? 'dark' : 'light'} theme`);
            }

            applyTheme(theme) {
                const isDark = theme === 'dark';
                // Using jQuery to set CSS variables is less direct. Native JS is better for this.
                // Keeping original for direct CSS variable manipulation.
                document.documentElement.style.setProperty('--bg', isDark ? '#0f172a' : '#f8fafc');
                document.documentElement.style.setProperty('--card', isDark ? '#1e293b' : '#ffffff');
                document.documentElement.style.setProperty('--text', isDark ? '#f1f5f9' : '#1f2937');
                document.documentElement.style.setProperty('--text-light', isDark ? '#94a3b8' : '#6b7280');
                document.documentElement.style.setProperty('--border', isDark ? '#334155' : '#e5e7eb');
            }

            loadSettings() {
                let config = null;
                if (window.AnswerIT_Config?.getConfig) {
                    config = window.AnswerIT_Config.getConfig();
                    this.showStatus('settingsStatus', '‚úÖ Userscript detected - settings sync automatically!', 'success');
                } else {
                    const saved = localStorage.getItem('answerIT_config');
                    if (saved) {
                        try { config = JSON.parse(saved); } catch (e) { console.error('Load error:', e); }
                    }
                    this.showStatus('settingsStatus', '‚ö†Ô∏è Userscript not detected - using local storage', 'warning');
                }
                if (config) {
                    if (config.apiKey) {
                        $('#apiKey').val(config.apiKey); // Use jQuery .val()
                        this.validateApiKey(config.apiKey);
                        this.showStatus('apiStatus', window.AnswerIT_Config ? 'API key loaded from userscript!' : 'API key loaded from storage!', 'success');
                    }
                    $('#hotkey').val(config.hotkey || 'a'); // Use jQuery .val()
                    $('#theme').val(config.theme || 'light'); // Use jQuery .val()
                    $('#autoRun').prop('checked', config.autoRun || false); // Use jQuery .prop() for checkboxes
                }
            }

            validateApiKey(key) {
                const $input = $('#apiKey'); // Use jQuery selector
                if (!key) { $input.attr('class', 'form-input'); return false; } // Use jQuery .attr()
                const valid = /^AIza[0-9A-Za-z-_]{35}$/.test(key);
                $input.attr('class', valid ? 'form-input success' : 'form-input error'); // Use jQuery .attr()
                return valid;
            }

            async testApiKey() {
                const apiKey = $('#apiKey').val().trim(); // Use jQuery .val()
                if (!apiKey) { this.showStatus('apiStatus', 'Please enter an API key first!', 'error'); return; }
                if (!this.validateApiKey(apiKey)) { this.showStatus('apiStatus', 'API key format invalid', 'warning'); return; }
                this.showStatus('apiStatus', 'Testing API key...', 'warning');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    this.showStatus('apiStatus', response.ok ? '‚úÖ API key is valid!' : '‚ùå API key is invalid', response.ok ? 'success' : 'error');
                } catch (error) {
                    this.showStatus('apiStatus', '‚ùå Network error testing API key', 'error');
                }
            }

            async saveApiKey() {
                const apiKey = $('#apiKey').val().trim(); // Use jQuery .val()
                if (!apiKey) { this.showStatus('apiStatus', 'Please enter an API key!', 'error'); return; }
                this.setButtonLoading('saveApi', true);
                try {
                    if (window.AnswerIT_Config?.setConfig) {
                        window.AnswerIT_Config.setConfig({ apiKey });
                    } else {
                        const config = this.getLocalConfig();
                        config.apiKey = apiKey;
                        localStorage.setItem('answerIT_config', JSON.stringify(config));
                    }
                    this.showStatus('apiStatus', '‚úÖ API key saved successfully!', 'success');
                    setTimeout(() => this.testApiKey(), 500);
                } catch (error) {
                    this.showStatus('apiStatus', '‚ùå Error saving API key', 'error');
                } finally {
                    this.setButtonLoading('saveApi', false);
                }
            }

            async saveSettings() {
                const settings = {
                    hotkey: $('#hotkey').val(), // Use jQuery .val()
                    theme: $('#theme').val(), // Use jQuery .val()
                    autoRun: $('#autoRun').prop('checked') // Use jQuery .prop()
                };
                this.setButtonLoading('saveSettings', true);
                try {
                    if (window.AnswerIT_Config?.setConfig) {
                        window.AnswerIT_Config.setConfig(settings);
                    } else {
                        const config = this.getLocalConfig();
                        Object.assign(config, settings);
                        localStorage.setItem('answerIT_config', JSON.stringify(config));
                    }
                    this.showStatus('settingsStatus', '‚úÖ Settings saved successfully!', 'success');
                } catch (error) {
                    this.showStatus('settingsStatus', '‚ùå Error saving settings', 'error');
                } finally {
                    this.setButtonLoading('saveSettings', false);
                }
            }

            renderSites() {
                const $grid = $('#sitesGrid'); // Use jQuery selector
                const sites = window.AnswerIT_Config?.supportedSites || [];
                const fallback = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><rect width="32" height="32" rx="8" fill="%23e5e7eb"/><text x="16" y="22" text-anchor="middle" font-size="18" fill="%23667eea" font-family="Arial">üåê</text></svg>';
                const getDomain = url => {
                    try {
                        let u = url.match(/^https?:\/\//) ? url : 'https://' + url;
                        return new URL(u).hostname;
                    } catch { return url.split('/')[0]; }
                };
                Promise.all(sites.map(async site => {
                    const domain = getDomain(site.urls[0]);
                    const faviconUrls = [
                        `https://www.google.com/s2/favicons?domain=${domain}&sz=32`,
                        `https://${domain}/favicon.ico`,
                        `https://${domain}/favicon.png`,
                        `https://${domain.replace(/^[^.]+\./, '')}/favicon.ico`,
                        `https://${domain.replace(/^[^.]+\./, '')}/favicon.png`,
                    ];
                    let favicon = fallback;
                    for (let url of faviconUrls) {
                        try {
                            const res = await fetch(url, { method: 'HEAD', mode: 'no-cors' });
                            if (res.ok || res.type === 'opaque') { favicon = url; break; }
                        } catch { }
                    }
                    // Create element using jQuery
                    const $card = $('<a>')
                        .addClass('site-card')
                        .attr('href', `https://${site.urls[0]}`)
                        .attr('target', '_blank')
                        .html(`<img class="site-favicon" src="${favicon}" alt="${site.name}"><h3>${site.name}</h3>`);
                    $grid.append($card); // Use jQuery .append()
                }));
            }

            setButtonLoading(btnId, loading) {
                const $btn = $(`#${btnId}`); // Use jQuery selector
                const $text = $(`#${btnId}Text`); // Use jQuery selector
                const $spinner = $(`#${btnId}Spinner`); // Use jQuery selector
                $btn.prop('disabled', loading); // Use jQuery .prop()
                $text.text(loading ? 'Saving...' : (btnId === 'saveApi' ? 'Save API Key' : 'üíæ Save Settings')); // Use jQuery .text()
                $spinner.css('display', loading ? 'block' : 'none'); // Use jQuery .css()
            }

            showStatus(id, message, type) {
                const $el = $(`#${id}`); // Use jQuery selector
                $el.text(message); // Use jQuery .text()
                $el.attr('class', `status ${type}`); // Use jQuery .attr()
                $el.css('display', 'flex'); // Use jQuery .css()
                if (type === 'success') {
                    setTimeout(() => $el.css('display', 'none'), 5000); // Use jQuery .css()
                }
            }

            getLocalConfig() {
                try {
                    const saved = localStorage.getItem('answerIT_config');
                    return saved ? JSON.parse(saved) : {};
                } catch (e) {
                    return {};
                }
            }
        }

        // Initialize when DOM is ready using jQuery's ready function
        $(function () {
            console.log('[ConfigPage] DOM loaded via jQuery ready, initializing ConfigManager');
            const cm = new ConfigManager();
            cm.reflectorInit();
        });
    </script>
</body>

</html>