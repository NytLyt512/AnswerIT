<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnswerIT!! - Setup & Configuration</title>
    <link rel="icon" href="https://i.pinimg.com/736x/d9/b5/a6/d9b5a64b2a0f432e41f611ddd410d8be.jpg">
    <style>
        :root {
            --primary: #667eea;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        .hero { background: linear-gradient(135deg, var(--primary), #764ba2); padding: 3rem 1rem; text-align: center; color: white; position: relative; }
        .theme-toggle { position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.5rem; border-radius: 8px; cursor: pointer; font-size: 1.25rem; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        .theme-toggle:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .detection-status { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.9); padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; margin-top: 1rem; backdrop-filter: blur(10px); }
        .detection-status.success { background: rgba(16,185,129,0.2); border-color: rgba(16,185,129,0.3); }
        .detection-status.warning { background: rgba(245,158,11,0.2); border-color: rgba(245,158,11,0.3); }
        .hero h1 { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 800; margin-bottom: 1rem; }
        .hero p { font-size: 1.25rem; opacity: 0.9; margin-bottom: 2rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-top: -4rem; position: relative; z-index: 2; }
        .preferences-section { margin-top: 3rem; }
        .preferences-section .card { max-width: 800px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 20px; padding: 2rem; box-shadow: var(--shadow); border: 1px solid var(--border); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(135deg, var(--primary), #764ba2); }
        .card:hover { transform: translateY(-5px); box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .card-icon { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), #764ba2); border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem; font-size: 1.5rem; }
        .card h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
        .card p { color: var(--text-light); margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        .preferences-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .toggle-label { display: flex; align-items: center; gap: 1rem; cursor: pointer; padding: 1rem; border: 2px solid var(--border); border-radius: 12px; transition: all 0.3s ease; background: rgba(102,126,234,0.02); }
        .toggle-label:hover { border-color: var(--primary); background: rgba(102,126,234,0.05); }
        .toggle-input { display: none; }
        .toggle-slider { width: 48px; height: 24px; background: var(--border); border-radius: 24px; position: relative; transition: all 0.3s ease; flex-shrink: 0; }
        .toggle-slider::before { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .toggle-input:checked + .toggle-slider { background: var(--primary); }
        .toggle-input:checked + .toggle-slider::before { transform: translateX(24px); }
        .toggle-text { font-weight: 600; font-size: 1rem; }
        .form-label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
        .form-input { width: 100%; padding: 0.875rem 1rem; border: 2px solid var(--border); border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: #fff; }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        .form-input.error { border-color: var(--error); }
        .form-input.success { border-color: var(--success); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.875rem 1.5rem; border: none; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; min-height: 48px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #5a67d8; transform: translateY(-2px); }
        .btn-secondary { background: var(--border); color: var(--text); margin-left: 0.5rem; }
        .btn-secondary:hover { background: #d1d5db; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }
        .status { padding: 1rem; border-radius: 12px; margin-bottom: 1rem; display: none; align-items: center; gap: 0.5rem; }
        .status.success { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid rgba(16,185,129,0.2); }
        .status.error { background: rgba(239,68,68,0.1); color: var(--error); border: 1px solid rgba(239,68,68,0.2); }
        .status.warning { background: rgba(245,158,11,0.1); color: var(--warning); border: 1px solid rgba(245,158,11,0.2); }
        .help-text { font-size: 0.875rem; color: var(--text-light); margin-top: 0.5rem; }
        .quick-links { display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
        .quick-link { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(102,126,234,0.1); color: var(--primary); border-radius: 8px; text-decoration: none; font-size: 0.875rem; font-weight: 500; transition: all 0.3s ease; }
        .quick-link:hover { background: rgba(102,126,234,0.2); transform: translateY(-1px); }
        .sites-section { margin-top: 4rem; }
        .sites-section h2 { text-align: center; font-size: 2rem; font-weight: 700; margin-bottom: 1rem; }
        .sites-section p { text-align: center; color: var(--text-light); margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto; }
        .sites-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .site-card { background: var(--card); padding: 1.5rem; border-radius: 15px; border: 1px solid var(--border); text-align: center; transition: all 0.3s ease; text-decoration: none; color: inherit; display: block; }
        .site-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary); }
        .site-favicon { width: 32px; height: 32px; margin: 0 auto 1rem; border-radius: 8px; }
        .site-card h3 { margin-bottom: 0.5rem; font-size: 1.25rem; }
        .spinner { width: 20px; height: 20px; border: 2px solid transparent; border-top: 2px solid currentColor; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; margin-top: -2rem; }
            .preferences-grid { grid-template-columns: 1fr; gap: 1rem; }
            .hero { padding: 2rem 1rem; }
            .container { padding: 1rem; }
            .card { padding: 1.5rem; }
            .quick-links { flex-direction: column; }
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text-light: #94a3b8; --border: #334155; }
        }
    </style>
</head>
<body>
    <div class="hero">
        <button id="themeToggle" class="theme-toggle" title="Toggle theme">üåô</button>
        <h1>üéØ AnswerIT!!</h1>
        <p>Setup your AI-powered answer generator and configure your preferences</p>
        <div id="detectionStatus" class="detection-status">üîç Detecting userscript...</div>
    </div>

    <div class="container">
        <div class="grid">
            <div class="card">
                <div class="card-icon">üìö</div>
                <h2>How to Use</h2>
                <p>Get started with AnswerIT!! in just a few steps</p>
                <div style="text-align: left; margin-top: 1rem;">
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 1:</strong> Get your free Gemini API key</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 2:</strong> Enter your API key above</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 3:</strong> Configure your preferences</div>
                    <div style="margin-bottom: 1rem;"><strong style="color: var(--primary);">Step 4:</strong> Use <span id="modifierKey">Alt</span> + [hotkey] on supported sites</div>
                </div>
                <div class="quick-links">
                    <a href="https://github.com/NytLyt512/Userscripts/tree/main/AnswerIT!!" target="_blank" class="quick-link">üìñ Github Page</a>
                    <a href="https://github.com/NytLyt512/Userscripts/issues/new?title=[AnswerIT!!]%20**Title%20of%20the%20issue**%20&body=**Describe%20the%20issue:**%0A%0A**Steps%20to%20reproduce:**%0A%0A**Expected%20behavior:**%0A%0A**Screenshots%20(optional):**%0A%0A**Environment:**%0A-%20Browser:%0A-%20OS:%0A" target="_blank" class="quick-link">üêõ Report Issues</a>
                </div>
            </div>

            <div class="card">
                <div class="card-icon">üîë</div>
                <h2>API Key Setup</h2>
                <p>Configure your Gemini API key to start using AI-powered answers</p>
                <div class="status" id="apiStatus"></div>
                <form id="apiForm">
                    <div class="form-group">
                        <label class="form-label">Gemini API Key</label>
                        <input type="password" id="apiKey" class="form-input" placeholder="Enter your Gemini API key..." autocomplete="off">
                        <div class="help-text">Your API key is stored securely and never sent to our servers.</div>
                    </div>
                    <div class="quick-links">
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="quick-link">üîó Get Free API Key</a>
                        <a href="#" id="testKey" class="quick-link">üß™ Test API Key</a>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveApi" style="margin-top: 1rem;">
                        <span id="saveApiText">Save API Key</span>
                        <div class="spinner" id="saveApiSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>
        </div>

        <div class="preferences-section">
            <div class="card">
                <div class="card-icon">‚öôÔ∏è</div>
                <h2>Preferences</h2>
                <p>Customize your AnswerIT!! experience</p>
                <div class="status" id="settingsStatus"></div>
                <form id="settingsForm">
                    <div class="preferences-grid">
                        <div class="form-group">
                            <label class="form-label">üî• Hotkey</label>
                            <select id="hotkey" class="form-input">
                                <option value="a"><span id="hotkeyModifier">Alt</span> + A</option>
                                <option value="q"><span id="hotkeyModifier">Alt</span> + Q</option>
                                <option value="z"><span id="hotkeyModifier">Alt</span> + Z</option>
                                <option value="x"><span id="hotkeyModifier">Alt</span> + X</option>
                            </select>
                            <div class="help-text">Keyboard shortcut to activate AnswerIT!!</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Theme</label>
                            <select id="theme" class="form-input">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto (System)</option>
                            </select>
                            <div class="help-text">Choose your preferred theme for the popup</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" id="autoRun" class="toggle-input">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Auto-run on question detection</span>
                        </label>
                        <div class="help-text">Automatically generate answers when questions are detected</div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveSettings" style="margin-top: 1rem;">
                        <span id="saveSettingsText">Save Settings</span>
                        <div class="spinner" id="saveSettingsSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>
        </div>

        <div class="sites-section">
            <h2>üåê Supported Learning Platforms</h2>
            <p>AnswerIT!! works seamlessly with these platforms. Click any site to visit it directly.</p>
            <div class="sites-grid" id="sitesGrid"></div>
        </div>
    </div>

    <script>
        class ConfigManager {
            constructor() {
                this.currentTheme = localStorage.getItem('answerIT_pageTheme') || 'light';
                this.isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                this.configDetected = false;
                this.initTheme();
                this.initModifierKeys();
                this.initEventListeners();
                this.detectUserscript();
            }

            async detectUserscript() {
                console.log('[ConfigPage] Starting userscript detection...');
                this.updateDetectionStatus('üîç Detecting userscript...', '');
                
                // Method 1: Check if already available
                if (window.AnswerIT_Config?.getConfig) {
                    console.log('[ConfigPage] Userscript detected immediately');
                    this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                    this.onConfigDetected();
                    return;
                }

                // Method 2: Wait for custom event
                const eventListener = (e) => {
                    console.log('[ConfigPage] Userscript detected via event');
                    window.removeEventListener('AnswerIT_ConfigReady', eventListener);
                    this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                    this.onConfigDetected();
                };
                window.addEventListener('AnswerIT_ConfigReady', eventListener);

                // Method 3: Polling with exponential backoff
                let attempts = 0;
                const maxAttempts = 15;
                const pollForConfig = () => {
                    attempts++;
                    console.log(`[ConfigPage] Polling attempt ${attempts}/${maxAttempts}`);
                    this.updateDetectionStatus(`üîç Checking for userscript... (${attempts}/${maxAttempts})`, '');
                    
                    if (window.AnswerIT_Config?.getConfig) {
                        console.log('[ConfigPage] Userscript detected via polling');
                        window.removeEventListener('AnswerIT_ConfigReady', eventListener);
                        this.updateDetectionStatus('‚úÖ Userscript connected!', 'success');
                        this.onConfigDetected();
                        return;
                    }
                    
                    if (attempts < maxAttempts) {
                        // Exponential backoff: 100ms, 200ms, 400ms, 800ms, etc.
                        const delay = Math.min(100 * Math.pow(2, attempts - 1), 2000);
                        setTimeout(pollForConfig, delay);
                    } else {
                        console.log('[ConfigPage] Userscript not detected, using fallback');
                        window.removeEventListener('AnswerIT_ConfigReady', eventListener);
                        this.updateDetectionStatus('‚ö†Ô∏è Using local storage mode', 'warning');
                        this.onConfigDetected(); // Load with fallback
                    }
                };
                
                // Start polling after a short delay
                setTimeout(pollForConfig, 100);
            }

            updateDetectionStatus(message, type) {
                const status = document.getElementById('detectionStatus');
                status.textContent = message;
                status.className = `detection-status ${type}`;
                
                // Hide status after successful connection
                if (type === 'success') {
                    setTimeout(() => {
                        status.style.opacity = '0';
                        setTimeout(() => status.style.display = 'none', 300);
                    }, 2000);
                }
            }

            onConfigDetected() {
                if (this.configDetected) return; // Prevent multiple calls
                this.configDetected = true;
                console.log('[ConfigPage] Initializing with config:', !!window.AnswerIT_Config);
                this.loadSettings();
                this.renderSites();
            }

            initTheme() {
                this.applyTheme(this.currentTheme);
                const toggle = document.getElementById('themeToggle');
                toggle.textContent = this.currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                toggle.title = `Switch to ${this.currentTheme === 'light' ? 'dark' : 'light'} theme`;
            }

            initModifierKeys() {
                const modifierKey = this.isMac ? 'Cmd' : 'Alt';
                document.getElementById('modifierKey').textContent = modifierKey;
                // Update hotkey options
                const hotkeySelect = document.getElementById('hotkey');
                Array.from(hotkeySelect.options).forEach(option => {
                    const key = option.value.toUpperCase();
                    option.textContent = `${modifierKey} + ${key}`;
                });
            }

            initEventListeners() {
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                document.getElementById('apiForm').addEventListener('submit', (e) => { e.preventDefault(); this.saveApiKey(); });
                document.getElementById('settingsForm').addEventListener('submit', (e) => { e.preventDefault(); this.saveSettings(); });
                document.getElementById('testKey').addEventListener('click', (e) => { e.preventDefault(); this.testApiKey(); });
                document.getElementById('apiKey').addEventListener('input', (e) => this.validateApiKey(e.target.value));
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                this.applyTheme(this.currentTheme);
                localStorage.setItem('answerIT_pageTheme', this.currentTheme);
                const toggle = document.getElementById('themeToggle');
                toggle.textContent = this.currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                toggle.title = `Switch to ${this.currentTheme === 'light' ? 'dark' : 'light'} theme`;
            }

            applyTheme(theme) {
                const isDark = theme === 'dark';
                document.documentElement.style.setProperty('--bg', isDark ? '#0f172a' : '#f8fafc');
                document.documentElement.style.setProperty('--card', isDark ? '#1e293b' : '#ffffff');
                document.documentElement.style.setProperty('--text', isDark ? '#f1f5f9' : '#1f2937');
                document.documentElement.style.setProperty('--text-light', isDark ? '#94a3b8' : '#6b7280');
                document.documentElement.style.setProperty('--border', isDark ? '#334155' : '#e5e7eb');
            }

            loadSettings() {
                let config = null;
                if (window.AnswerIT_Config?.getConfig) {
                    config = window.AnswerIT_Config.getConfig();
                    this.showStatus('settingsStatus', '‚úÖ Userscript detected - settings sync automatically!', 'success');
                } else {
                    const saved = localStorage.getItem('answerIT_config');
                    if (saved) {
                        try { config = JSON.parse(saved); } catch (e) { console.error('Load error:', e); }
                    }
                    this.showStatus('settingsStatus', '‚ö†Ô∏è Userscript not detected - using local storage', 'warning');
                }
                if (config) {
                    if (config.apiKey) {
                        document.getElementById('apiKey').value = config.apiKey;
                        this.validateApiKey(config.apiKey);
                        this.showStatus('apiStatus', window.AnswerIT_Config ? 'API key loaded from userscript!' : 'API key loaded from storage!', 'success');
                    }
                    document.getElementById('hotkey').value = config.hotkey || 'a';
                    document.getElementById('theme').value = config.theme || 'light';
                    document.getElementById('autoRun').checked = config.autoRun || false;
                }
            }

            validateApiKey(key) {
                const input = document.getElementById('apiKey');
                if (!key) { input.className = 'form-input'; return false; }
                const valid = /^AIza[0-9A-Za-z-_]{35}$/.test(key);
                input.className = valid ? 'form-input success' : 'form-input error';
                return valid;
            }

            async testApiKey() {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) { this.showStatus('apiStatus', 'Please enter an API key first!', 'error'); return; }
                if (!this.validateApiKey(apiKey)) { this.showStatus('apiStatus', 'API key format invalid', 'warning'); return; }
                this.showStatus('apiStatus', 'Testing API key...', 'warning');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    this.showStatus('apiStatus', response.ok ? '‚úÖ API key is valid!' : '‚ùå API key is invalid', response.ok ? 'success' : 'error');
                } catch (error) {
                    this.showStatus('apiStatus', '‚ùå Network error testing API key', 'error');
                }
            }

            async saveApiKey() {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) { this.showStatus('apiStatus', 'Please enter an API key!', 'error'); return; }
                this.setButtonLoading('saveApi', true);
                try {
                    if (window.AnswerIT_Config?.setConfig) {
                        window.AnswerIT_Config.setConfig({ apiKey });
                    } else {
                        const config = this.getLocalConfig();
                        config.apiKey = apiKey;
                        localStorage.setItem('answerIT_config', JSON.stringify(config));
                    }
                    this.showStatus('apiStatus', '‚úÖ API key saved successfully!', 'success');
                    setTimeout(() => this.testApiKey(), 500);
                } catch (error) {
                    this.showStatus('apiStatus', '‚ùå Error saving API key', 'error');
                } finally {
                    this.setButtonLoading('saveApi', false);
                }
            }

            async saveSettings() {
                const settings = {
                    hotkey: document.getElementById('hotkey').value,
                    theme: document.getElementById('theme').value,
                    autoRun: document.getElementById('autoRun').checked
                };
                this.setButtonLoading('saveSettings', true);
                try {
                    if (window.AnswerIT_Config?.setConfig) {
                        window.AnswerIT_Config.setConfig(settings);
                    } else {
                        const config = this.getLocalConfig();
                        Object.assign(config, settings);
                        localStorage.setItem('answerIT_config', JSON.stringify(config));
                    }
                    this.showStatus('settingsStatus', '‚úÖ Settings saved successfully!', 'success');
                } catch (error) {
                    this.showStatus('settingsStatus', '‚ùå Error saving settings', 'error');
                } finally {
                    this.setButtonLoading('saveSettings', false);
                }
            }

            renderSites() {
                const grid = document.getElementById('sitesGrid');
                const sites = window.AnswerIT_Config?.supportedSites || [];
                const fallback = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><rect width="32" height="32" rx="8" fill="%23e5e7eb"/><text x="16" y="22" text-anchor="middle" font-size="18" fill="%23667eea" font-family="Arial">üåê</text></svg>';
                const getDomain = url => {
                    try {
                        let u = url.match(/^https?:\/\//) ? url : 'https://' + url;
                        return new URL(u).hostname;
                    } catch { return url.split('/')[0]; }
                };
                Promise.all(sites.map(async site => {
                    const domain = getDomain(site.urls[0]);
                    const faviconUrls = [
                        `https://www.google.com/s2/favicons?domain=${domain}&sz=32`,
                        `https://${domain}/favicon.ico`,
                        `https://${domain}/favicon.png`
                    ];
                    let favicon = fallback;
                    for (let url of faviconUrls) {
                        try {
                            const res = await fetch(url, { method: 'HEAD', mode: 'no-cors' });
                            if (res.ok || res.type === 'opaque') { favicon = url; break; }
                        } catch {}
                    }
                    const card = document.createElement('a');
                    card.className = 'site-card';
                    card.href = `https://${site.urls[0]}`;
                    card.target = '_blank';
                    card.innerHTML = `<img class="site-favicon" src="${favicon}" alt="${site.name}"><h3>${site.name}</h3>`;
                    grid.appendChild(card);
                }));
            }

            setButtonLoading(btnId, loading) {
                const btn = document.getElementById(btnId);
                const text = document.getElementById(btnId + 'Text');
                const spinner = document.getElementById(btnId + 'Spinner');
                btn.disabled = loading;
                text.textContent = loading ? 'Saving...' : (btnId === 'saveApi' ? 'Save API Key' : 'üíæ Save Settings');
                spinner.style.display = loading ? 'block' : 'none';
            }

            showStatus(id, message, type) {
                const el = document.getElementById(id);
                el.textContent = message;
                el.className = `status ${type}`;
                el.style.display = 'flex';
                if (type === 'success') setTimeout(() => el.style.display = 'none', 5000);
            }

            getLocalConfig() {
                try {
                    const saved = localStorage.getItem('answerIT_config');
                    return saved ? JSON.parse(saved) : {};
                } catch (e) {
                    return {};
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[ConfigPage] DOM loaded, initializing ConfigManager');
            new ConfigManager();
        });

        // Fallback initialization for when DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            // DOM hasn't loaded yet
        } else {
            // DOM already loaded
            console.log('[ConfigPage] DOM already ready, initializing ConfigManager');
            new ConfigManager();
        }
    </script>
</body>
</html>
